config {
  base_url = "http://localhost:8080";
  header "Content-Type" = "application/json";
  header "X-App" = "TestLangDemo";
}

let user = "admin";
let id = 42;

// Login flow
test Login {
  POST "/api/login" {
    body = "{ \"username\": \"$user\", \"password\": \"1234\" }";
  };
  expect status = 200;
  expect header "Content-Type" contains "json";
  expect body contains "\"token\":";
}

// Get user
test GetUser {
  GET "/api/users/$id";
  expect status in 200..299;
  expect body contains "\"id\": 42";
}

// Update user
test UpdateUser {
  PUT "/api/users/$id" {
    header "X-Trace" = "abc-$id";
    body = "{ \"role\": \"ADMIN\" }";
  };
  expect status = 200;
  expect header "X-App" = "TestLangDemo";
  expect header "Content-Type" contains "json";
  expect body contains "\"updated\": true";
  expect body contains "\"role\": \"ADMIN\"";
}

